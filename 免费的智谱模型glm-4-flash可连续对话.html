<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AIå¯¹è¯åŠ©æ‰‹</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
	<script>
		tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // ç´«è‰²ä½œä¸ºä¸»è‰²è°ƒï¼Œä¼ è¾¾ç§‘æŠ€æ„Ÿå’Œåˆ›æ–°æ€§
                        secondary: '#818CF8', // æµ…ç´«è‰²ä½œä¸ºè¾…åŠ©è‰²
                        accent: '#F97316', // æ©™è‰²ä½œä¸ºå¼ºè°ƒè‰²
                        neutral: {
                            100: '#F5F5F5',
                            200: '#E5E5E5',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
	</script>
	<style type="text/tailwindcss">
		@layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .animate-typing {
                animation: typing 1.5s steps(20) infinite;
            }
            .animate-pulse-slow {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .message-appear {
                animation: messageAppear 0.3s ease-out forwards;
            }
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes messageAppear {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-neutral-100 to-neutral-200 min-h-screen font-sans text-neutral-800">
	<div class="container mx-auto px-4 py-8 max-w-4xl">
		<!-- æ ‡é¢˜åŒºåŸŸ -->
		<header class="text-center mb-8">
			<h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-primary mb-2 flex items-center justify-center">
				<i class="fa-solid fa-robot mr-3"></i>AIå¯¹è¯åŠ©æ‰‹
			</h1>
			<p class="text-neutral-600 max-w-2xl mx-auto">
				ä¸æ™ºè°±æ¨¡å‹GLM-4-Flashè¿›è¡Œè¿ç»­å¯¹è¯ï¼Œè·å–æ™ºèƒ½å›ç­”å’Œå»ºè®®
			</p>
		</header>

		<!-- èŠå¤©å®¹å™¨ -->
		<div class="bg-white rounded-2xl shadow-xl overflow-hidden h-[70vh] min-h-[500px] max-h-[800px] flex flex-col">
			<!-- èŠå¤©å¤´éƒ¨ -->
			<div class="bg-primary text-white p-4 flex items-center justify-between border-b border-primary/20">
				<div class="flex items-center">
					<div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-3">
						<i class="fa-solid fa-robot text-xl"></i>
					</div>
					<div>
						<h2 class="font-semibold">GLM-4-Flash</h2>
						<p class="text-xs text-white/80">æ™ºè°±AIæ¨¡å‹</p>
					</div>
				</div>
				<div class="flex gap-3">
					<button id="clearChat" class="text-white/80 hover:text-white transition-colors">
                        <i class="fa-solid fa-trash"></i>
                    </button>
					<button id="themeToggle" class="text-white/80 hover:text-white transition-colors">
                        <i class="fa-solid fa-moon"></i>
                    </button>
				</div>
			</div>

			<!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
			<div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide bg-neutral-50">
				<!-- åˆå§‹æ¬¢è¿æ¶ˆæ¯ -->
				<div class="message-appear opacity-0" style="animation-delay: 0.2s">
					<div class="flex items-start">
						<div
							class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0">
							<i class="fa-solid fa-robot text-primary"></i>
						</div>
						<div class="bg-white rounded-lg shadow-sm p-4 max-w-[85%] rounded-tl-none">
							<p class="text-neutral-800">ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯GLM-4-Flashï¼Œæ™ºè°±AIå¼€å‘çš„å¤§å‹è¯­è¨€æ¨¡å‹ã€‚æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</p>
						</div>
					</div>
				</div>
			</div>

			<!-- è¾“å…¥åŒºåŸŸ -->
			<div class="p-4 border-t border-neutral-200 bg-white">
				<form id="messageForm" class="flex gap-3">
					<div class="flex-1 relative">
						<textarea
                            id="messageInput"
                            placeholder="è¾“å…¥æ¶ˆæ¯..."
                            class="w-full px-4 py-3 rounded-lg border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none min-h-[48px]"
                            required
                        ></textarea>
						<div id="charCount" class="absolute right-3 bottom-2 text-xs text-neutral-500">0/2000</div>
					</div>
					<button
                        type="submit"
                        id="sendButton"
                        class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-3 rounded-lg transition-all flex items-center justify-center gap-2 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        <i class="fa-solid fa-paper-plane"></i>
                        <span>å‘é€</span>
                    </button>
				</form>
			</div>
		</div>

		<!-- ç§»åŠ¨ç«¯æç¤º -->
		<div class="mt-4 text-center text-sm text-neutral-600">
			<p>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æ—¶ï¼Œå»ºè®®å…¨å±æŸ¥çœ‹ä»¥è·å¾—æ›´å¥½çš„ä½“éªŒ</p>
		</div>
	</div>

	<footer class="bg-neutral-800 text-white py-6 mt-8">
		<div class="container mx-auto px-4 max-w-4xl text-center">
			<p class="text-neutral-400">Â© 2025 AIå¯¹è¯åŠ©æ‰‹ - ç”±æ™ºè°±AIæä¾›æŠ€æœ¯æ”¯æŒ</p>
		</div>
	</footer>

	<script>
		// DOMå…ƒç´ 
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');
        const charCount = document.getElementById('charCount');
        const chatMessages = document.getElementById('chatMessages');
        const sendButton = document.getElementById('sendButton');
        const clearChatButton = document.getElementById('clearChat');
        const themeToggleButton = document.getElementById('themeToggle');
        
        // çŠ¶æ€å˜é‡
        let conversationHistory = [];
        let isWaitingForResponse = false;
        let darkMode = false;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // è®¾ç½®æ–‡æœ¬æ¡†é«˜åº¦è‡ªé€‚åº”
            messageInput.addEventListener('input', adjustTextareaHeight);
            
            // é™åˆ¶æœ€å¤§è¾“å…¥é•¿åº¦
            messageInput.addEventListener('input', updateCharCount);
            
            // æäº¤è¡¨å•
            messageForm.addEventListener('submit', handleSendMessage);
            
            // æ¸…ç©ºèŠå¤©
            clearChatButton.addEventListener('click', clearChat);
            
            // åˆ‡æ¢ä¸»é¢˜
            themeToggleButton.addEventListener('click', toggleTheme);
            
            // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
            messageInput.focus();
        });
        
        // è°ƒæ•´æ–‡æœ¬æ¡†é«˜åº¦
        function adjustTextareaHeight() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        }
        
        // æ›´æ–°å­—ç¬¦è®¡æ•°
        function updateCharCount() {
            const length = this.value.length;
            const maxLength = 2000;
            
            charCount.textContent = `${length}/${maxLength}`;
            
            if (length > maxLength) {
                charCount.classList.add('text-red-500');
                this.value = this.value.substring(0, maxLength);
                charCount.textContent = `${maxLength}/${maxLength}`;
            } else {
                charCount.classList.remove('text-red-500');
            }
        }
        
        // å¤„ç†å‘é€æ¶ˆæ¯
        async function handleSendMessage(e) {
            e.preventDefault();
            
            const message = messageInput.value.trim();
            
            if (!message || isWaitingForResponse) {
                return;
            }
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å¯¹è¯
            addMessageToChat('user', message);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            messageInput.value = '';
            messageInput.style.height = 'auto';
            charCount.textContent = '0/2000';
            
            // æ›´æ–°å¯¹è¯å†å²
            conversationHistory.push({
                role: 'user',
                content: message
            });
            
            // æ˜¾ç¤ºAIæ­£åœ¨æ€è€ƒçš„çŠ¶æ€
            const thinkingMessageId = addThinkingIndicator();
            
            // ç¦ç”¨å‘é€æŒ‰é’®
            isWaitingForResponse = true;
            sendButton.disabled = true;
            
            try {
                // è°ƒç”¨APIè·å–AIå›å¤
                const response = await fetchAIResponse(message);
                
                // ç§»é™¤æ€è€ƒçŠ¶æ€
                removeElement(thinkingMessageId);
                
                // æ·»åŠ AIå›å¤åˆ°å¯¹è¯
                addMessageToChat('assistant', response);
                
                // æ›´æ–°å¯¹è¯å†å²
                conversationHistory.push({
                    role: 'assistant',
                    content: response
                });
            } catch (error) {
                // ç§»é™¤æ€è€ƒçŠ¶æ€
                removeElement(thinkingMessageId);
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                addMessageToChat('system', 'æŠ±æ­‰ï¼Œè·å–å›å¤æ—¶å‡ºç°é”™è¯¯ã€‚è¯·ç¨åå†è¯•ã€‚');
                console.error('è·å–AIå›å¤æ—¶å‡ºé”™:', error);
            } finally {
                // å¯ç”¨å‘é€æŒ‰é’®
                isWaitingForResponse = false;
                sendButton.disabled = false;
                
                // èšç„¦åˆ°è¾“å…¥æ¡†
                messageInput.focus();
            }
        }
        
        // è°ƒç”¨AI APIè·å–å›å¤
        async function fetchAIResponse(message) {
            // æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®å°†APIå¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨å‰ç«¯ä»£ç ä¸­
            const encodedMessage = encodeURIComponent(message);
            const apiUrl = `https://oiapi.net/API/BigModel/?message=${encodedMessage}`;
            
            const response = await fetch(apiUrl);
            
            if (!response.ok) {
                throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.code === 1 && data.message) {
                return data.message;
            } else {
                throw new Error('APIè¿”å›é”™è¯¯æˆ–æ— æ•ˆæ•°æ®');
            }
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
        function addMessageToChat(role, content) {
            const messageId = `msg-${Date.now()}`;
            let messageHtml = '';
            
            if (role === 'user') {
                messageHtml = `
                    <div id="${messageId}" class="message-appear opacity-0 flex justify-end">
                        <div class="flex items-start">
                            <div class="bg-primary text-white rounded-lg shadow-sm p-4 max-w-[85%] rounded-tr-none">
                                <p>${escapeHTML(content)}</p>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center ml-3 flex-shrink-0">
                                <i class="fa-solid fa-user text-primary"></i>
                            </div>
                        </div>
                    </div>
                `;
            } else if (role === 'assistant') {
                messageHtml = `
                    <div id="${messageId}" class="message-appear opacity-0">
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fa-solid fa-robot text-primary"></i>
                            </div>
                            <div class="bg-white rounded-lg shadow-sm p-4 max-w-[85%] rounded-tl-none">
                                <p>${escapeHTML(content)}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (role === 'system') {
                messageHtml = `
                    <div id="${messageId}" class="message-appear opacity-0 text-center">
                        <div class="inline-block bg-neutral-200 text-neutral-700 rounded-full px-4 py-1 text-sm">
                            ${escapeHTML(content)}
                        </div>
                    </div>
                `;
            }
            
            chatMessages.insertAdjacentHTML('beforeend', messageHtml);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            scrollToBottom();
            
            // è§¦å‘åŠ¨ç”»
            setTimeout(() => {
                const messageElement = document.getElementById(messageId);
                if (messageElement) {
                    messageElement.style.opacity = '1';
                }
            }, 50);
            
            return messageId;
        }
        
        // æ·»åŠ æ€è€ƒæŒ‡ç¤ºå™¨
        function addThinkingIndicator() {
            const thinkingId = `thinking-${Date.now()}`;
            const thinkingHtml = `
                <div id="${thinkingId}" class="message-appear opacity-0">
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="fa-solid fa-robot text-primary"></i>
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-4 max-w-[85%] rounded-tl-none">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 rounded-full bg-primary animate-pulse-slow"></div>
                                <div class="w-2 h-2 rounded-full bg-primary animate-pulse-slow" style="animation-delay: 0.2s"></div>
                                <div class="w-2 h-2 rounded-full bg-primary animate-pulse-slow" style="animation-delay: 0.4s"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.insertAdjacentHTML('beforeend', thinkingHtml);
            scrollToBottom();
            
            // è§¦å‘åŠ¨ç”»
            setTimeout(() => {
                const thinkingElement = document.getElementById(thinkingId);
                if (thinkingElement) {
                    thinkingElement.style.opacity = '1';
                }
            }, 50);
            
            return thinkingId;
        }
        
        // æ¸…ç©ºèŠå¤©
        function clearChat() {
            // ä¿ç•™æ¬¢è¿æ¶ˆæ¯
            const welcomeMessage = chatMessages.firstElementChild;
            chatMessages.innerHTML = '';
            if (welcomeMessage) {
                chatMessages.appendChild(welcomeMessage);
                welcomeMessage.style.opacity = '1';
            }
            
            // é‡ç½®å¯¹è¯å†å²
            conversationHistory = [];
            
            // èšç„¦åˆ°è¾“å…¥æ¡†
            messageInput.focus();
        }
        
        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            darkMode = !darkMode;
            
            if (darkMode) {
                document.body.classList.add('bg-neutral-900');
                document.body.classList.remove('bg-gradient-to-br', 'from-neutral-100', 'to-neutral-200');
                
                const chatContainer = chatMessages.parentElement;
                chatContainer.classList.add('bg-neutral-800');
                chatContainer.classList.remove('bg-white');
                
                chatMessages.classList.add('bg-neutral-900');
                chatMessages.classList.remove('bg-neutral-50');
                
                const messageBubbles = chatMessages.querySelectorAll('.bg-white:not(.rounded-full)');
                messageBubbles.forEach(bubble => {
                    bubble.classList.add('bg-neutral-700', 'text-white');
                    bubble.classList.remove('bg-white', 'text-neutral-800');
                });
                
                themeToggleButton.innerHTML = '<i class="fa-solid fa-sun"></i>';
            } else {
                document.body.classList.remove('bg-neutral-900');
                document.body.classList.add('bg-gradient-to-br', 'from-neutral-100', 'to-neutral-200');
                
                const chatContainer = chatMessages.parentElement;
                chatContainer.classList.remove('bg-neutral-800');
                chatContainer.classList.add('bg-white');
                
                chatMessages.classList.remove('bg-neutral-900');
                chatMessages.classList.add('bg-neutral-50');
                
                const messageBubbles = chatMessages.querySelectorAll('.bg-neutral-700:not(.rounded-full)');
                messageBubbles.forEach(bubble => {
                    bubble.classList.remove('bg-neutral-700', 'text-white');
                    bubble.classList.add('bg-white', 'text-neutral-800');
                });
                
                themeToggleButton.innerHTML = '<i class="fa-solid fa-moon"></i>';
            }
        }
        
        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // ç§»é™¤å…ƒç´ 
        function removeElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.remove();
            }
        }
        
        // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
        function escapeHTML(str) {
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }
	</script>
</body>

</html>